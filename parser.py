import struct


class Packet:
    def __init__(self, raw):
        self.raw = raw
        self.data = raw[3:]
        self.header = abs(struct.unpack("B", raw[0:1])[0])  # Header (size)
        self.extended = struct.unpack("B", raw[1:2])[0]
        self.packet_id = struct.unpack("B", raw[2:3])[0]
        if self.extended > 0:
            self.dat = raw[4:]
            somethingelse = self.packet_id
            self.packet_id = struct.unpack("B", raw[3:4])[0]
        pass

    def gethex(self):
        return self.raw.hex()


def parse(data, origin):
    if origin == "client":
        packet = Packet(data)
        #print(packet.gethex())
        # print(f"PACKET {packet.packet_id} WITH SIZE {packet.header}")
        if packet.packet_id in handlers:
            handlers.get(packet.packet_id)(packet)
        print(packet.gethex())


def player_position(packet):
    x = struct.unpack(">d", packet.raw[3:11])[0]
    y = struct.unpack(">d", packet.raw[11:19])[0]
    z = struct.unpack(">d", packet.raw[19:27])[0]
    onground = struct.unpack("?", packet.raw[27:])[0]
    print(f"X: {round(x, 3)} Y: {round(y, 5)} Z: {round(z, 3)} on_ground: {onground}")
    pass


handlers = {
    17: player_position
}


'''

ln m->id   ? x                 y                 z             onground
1b 00 11 c03adec029f6a0fc 405 a8000000000004 0 55ca68e84ff0b5 01
1b 00 11 c03ad5bf08022374 405 a8000000000004 0 55d82b74144e51 01
1b 00 11 c03acc31d534931b 405 a8000000000004 0 55e5fa1594187e 01
1b 00 11 c03ac258288fa687 405 a8000000000004 0 55f3cf50416fed 01
1b 00 11 c03aa84eb3c39017 405 a8000000000004 0 55feebd887c37c 01
1b 00 11 c03a856ebda5dc80 405 a8000000000004 0 56088bfb4a3e7d 01
1b 00 11 c03a5dbb73933817 405 a8000000000004 0 56115c6bbc7fec 01
1b 00 11 c03a3365ac48230d 405 a8000000000004 0 5619bb75302b55 01
1b 00 11 c03a079f9f954a8a 405 a8000000000004 0 5621dc93b71562 01
1b 00 11 c039db107f6a4ed1 405 a8000000000004 0 5629dbe3a2df3f 01
1b 00 11 c039ae1395a34b35 405 a8000000000004 0 5631c8be245142 01
1b 00 11 c03980daba32268a 405 a8000000000004 0 5639ab849205cf 01
1b 00 11 c0394efc7afce86f 405 a8000000000004 0 563cd11ec6d144 01
1b 00 11 c0391a94d39fd7fd 405 a8000000000004 0 563d6054879ff4 01
1b 00 11 c038e4ca98c1e3c6 405 a8000000000004 0 563c85dfb67a5e 01
1b 00 11 c038ae3ec4a4cad3 405 a8000000000004 0 563ae5f29f66aa 01
1b 00 11 c03877493c1613ed 405 a8000000000004 0 5638da33fcf82e 01
1b 00 11 c0384019fc865444 405 a8000000000004 0 56369396e8a04b 01
1b 00 11 c03808cb39cf603d 405 a8000000000004 0 56342cd55d85b9 01
1b 00 11 c037d16b426de4e0 405 a8000000000004 0 5631b487148385 01
1b 00 11 c0379a01e619ba5e 405 a8000000000004 0 562f32a3c1f3c2 01
1b 00 11 c037629368ab836b 405 a8000000000004 0 562cab85139b5b 01
1b 00 11 c03748f1ff0f8535 405 a8000000000004 0 5624fedf2f600d 01
1b 00 11 c0373f960f80627c 405 a8000000000004 0 561a82da74889c 01
1b 00 11 c0373f1c79b07e74 405 a8000000000004 0 560e7e0efceacb 01
1b 00 11 c03743bf123c4c21 405 a8000000000004 0 5601a2cecfcc10 01
1b 00 11 c0374ae98c6d5550 405 a8000000000004 0 55f45276d848e8 01
1b 00 11 c0375375c4e74f90 405 a8000000000004 0 55e6c230182dfb 01
1b 00 11 c037582089a9ca11 405 a8000000000004 0 55df5a5322e813 01
1b 00 11 c0375aace1a84ce4 405 a8000000000004 0 55db4f2ef1448c 01
1b 00 11 c0375c110faa32dd 405 a8000000000004 0 55d919ff00f778 01
1b 00 11 c03f2d246a922cfe 405 b43ebcc21ed2e4 0 58640405267c99 00
1b 00 11 c03f2d246a922cfe 405 b2bec0a0c4f824 0 58640405267c99 00
1b 00 11 c03f2d246a922cfe 405 b13ec2f2c241b4 0 58640405267c99 00
1b 00 11 c03f2d246a922cfe 405 afbec456c0a104 0 58640405267c99 00
1b 00 11 c03f2d246a922cfe 405 ae3ec52bf2da34 0 58640405267c99 00
1b 00 11 c03f2d246a922cfe 405 acbec5ab7762f4 0 58640405267c99 00
1b 00 11 c03f2d246a922cfe 405 ab3ec5f793b504 0 58640405267c99 00
1b 00 11 c03f2d246a922cfe 405 a9bec624d7e644 0 58640405267c99 00
1b 00 11 c03f2d246a922cfe 405 a83ec63f9a6a34 0 58640405267c99 00

1b 00 11 40574046b106b419 405 da7d1a428310ac 0 7729da14236a80 00
1b 00 11 405737273d4d0ef4 405 da7d1a428310ac 0 7729cff553e7fe 00
1b 00 11 40572894db3a5104 405 da7d1a428310ac 0 7729c5d684657c 00
1b 00 11 4057150d16022dc9 405 da7d1a428310ac 0 7729bbb7b4e2fa 00
1b 00 11 4056fd022c515973 405 da7d1a428310ac 0 7729b198e56078 00
1b 00 11 4056e0dc14a15853 405 da7d1a428310ac 0 7729a77a15ddf6 00
1b 00 11 4056c0f96a1e5d5d 405 da7d1a428310ac 0 77299d5b465b74 00
1b 00 11 40569db0443b083d 405 da7d1a428310ac 0 7729933c76d8f2 00
1b 00 11 4056774efadd3e36 405 da7d1a428310ac 0 7729891da75670 00
1b 00 11 40564e1cd8e32306 405 da7d1a428310ac 0 77297efed7d3ee 00
1b 00 11 4056225abe96fbb0 405 da7d1a428310ac 0 772974e008516c 00
1b 00 11 4055f443b58428ab 405 da7d1a428310ac 0 77296ac138ceea 00
1b 00 11 4055c40d76fe140c 405 da7d1a428310ac 0 772960a2694c68 00
1b 00 11 405591e8e68b9ef5 405 da7d1a428310ac 0 7729568399c9e6 00
1b 00 11 40555e02814e02d1 405 da7d1a428310ac 0 77294c64ca4764 00
1b 00 11 40552882c360ffc7 405 da7d1a428310ac 0 77294245fac4e2 00
1b 00 11 4054f18e841b5911 405 da7d1a428310ac 0 772938272b4260 00
1b 00 11 4054b9474a01d5ad 405 da7d1a428310ac 0 77292e085bbfde 00
1b 00 11 40547fcb972c1079 405 da7d1a428310ac 0 772923e98c3d5c 00
1b 00 11 405445372ec92b7e 405 da7d1a428310ac 0 772919cabcbada 00
1b 00 11 405409a35462cf5d 405 da7d1a428310ac 0 77290fabed3858 00
1b 00 11 4053cd27056e9e18 405 da7d1a428310ac 0 7729058d1db5d6 00
1b 00 11 40538fd72db14725 405 da7d1a428310ac 0 7728fb6e4e3354 00
1b 00 11 405351c6d6ea9c5a 405 da7d1a428310ac 0 7728f14f7eb0d2 00
1b 00 11 40531307543748e2 405 da7d1a428310ac 0 7728e730af2e50 00
1b 00 11 4052d3a8698b049b 405 da7d1a428310ac 0 7728dd11dfabce 00
1b 00 11 405293b86f9d38a7 405 da7d1a428310ac 0 7728d2f310294c 00
1b 00 11 405253447499f168 405 da7d1a428310ac 0 7728c8d440a6ca 00
1b 00 11 4052125859e19c0b 405 da7d1a428310ac 0 7728beb5712448 00
1b 00 11 4051d0feef1b5975 405 da7d1a428310ac 0 7728b496a1a1c6 00
1b 00 11 40518f420ad79695 405 da7d1a428310ac 0 7728aa77d21f44 00
1b 00 11 40514d2aa0fb0ccc 405 da7d1a428310ac 0 7728a059029cc2 00
1b 00 11 40510ac0d7253fc6 405 da7d1a428310ac 0 7728963a331a40 00
1b 00 11 4050c80c1740f528 405 da7d1a428310ac 0 77288c1b6397be 00
1b 00 11 405085132068f36e 405 da7d1a428310ac 0 772881fc94153c 00
1b 00 11 405041dc164786a8 405 da7d1a428310ac 0 772877ddc492ba 00
1b 00 11 404ffcd91e27a5d6 405 da7d1a428310ac 0 77286dbef51038 00
1b 00 11 404f75934099aa34 405 da7d1a428310ac 0 772863a0258db6 00
1b 00 11 404eedefd49e289c 405 da7d1a428310ac 0 77285981560b34 00
1b 00 11 404e65f745bed34a 405 da7d1a428310ac 0 77284f628688b2 00
1b 00 11 404dddb13d85c87e 405 da7d1a428310ac 0 77284543b70630 00
1b 00 11 404ccc5e54ec2f84 405 da7d1a428310ac 0 77281134d985cc 00
1b 00 11 404c435d33902bf4 405 da7d1a428310ac 0 7727e0393b23b2 00
1b 00 11 404bba28941bbf90 405 da7d1a428310ac 0 7727a1c27fbaf2 00
1b 00 11 4047a25e30e2f3bc 405 da7d1a428310ac 0 77132e34f859ba 00
1b 00 11 404541355ab2f68c 405 da7d1a428310ac 0 76e0b7bc180f72 00
1b 00 11 404251b37ddd4550 405 da7d1a428310ac 0 7653937fd9bd14 00
1b 00 11 4041c6a081d32fa6 405 d7c0afc1b643dc 0 762692ad2357f0 00
1b 00 11 40419c620f02bafe 405 d67273f3a1c8fc 0 761730c6bb916a 00
1b 00 11 404173e47e5bf494 405 d51050112f18dc 0 7607a54491aa0a 00
1b 00 11 40414cff6999523e 405 d3a23a88ea48cc 0 75f7f3e54e1276 00
1b 00 11 4040a8efece406ba 405 cdb99e9dd4d87c 0 75b8c553272954 00
1b 00 11 40407b033d902446 405 cc3b0341b4222c 0 75a90b28931af0 00
1b 00 11 40404b627689cd8a 405 cabbd93d3a1b2c 0 75995809fdbdf0 00
1b 00 11 40401a34d762e196 405 c93c59a08a7d5c 0 7589ab550b0a92 00
1b 00 11 403e1949d17371f0 405 c1bd0b384077cc 0 753bf01dfaac3a 00
1b 00 11 403da4bdcaa9d0d2 405 c03d1134c181bc 0 752c88de4956ec 00
1b 00 11 403d2dd7f7b30aac 405 bebd14cbdbbaec 0 751d2ba8f10d5e 00
1b 00 11 403cb4ce81f88d38 405 bd3d16f2eb76cc 0 750dd7969d0390 00
1b 00 11 403b3f24b839bbdc 405 b8bd197924e10c 0 74e00622767530 00
1b 00 11 403a3edbf9de541a 405 b5bd19e99e990c 0 74c196f021c8c4 00
1b 00 11 403597e9c54c63c4 405 a6bd1a1f9f63ac 0 742631d2908652 00
1b 00 11 403bb6b95e1bef96 405 6e56b39403108c 0 71d047e3ade9a6 00
1b 00 11 403bbe7ac9267a08 405 6dcc762303108c 0 71bf74bb4574de 00
1b 00 11 403bc052f182c13a 405 6d798478cfdd5c 0 71ae943358a8dc 00
1b 00 11 403bbcca08b39ce6 405 6d47c045e4583c 0 719da780055466 00
1b 00 11 403bb45bfe56c07e 405 6d29e42757085c 0 718cafb9ae4618 00
1b 00 11 403ba7799a8dd016 405 6d17f9ae9bd86c 0 717baddf7a354e 00
1b 00 11 403b96897efcb900 405 6d0d39cc91eedc 0 716aa2d9992aa2 00
1b 00 11 403b81e910a6e954 405 6d06c6ab58c91c 0 71598f7b5594b2 00
1b 00 11 403b69ed4cc04d0c 405 6d02e7fdd018dc 0 71487484f5bee6 00
1b 00 11 403b4ee38a570198 405 6d02e7fdd018dc 0 713752a571f358 00
1b 00 11 403b214dacd700d4 405 6d02e7fdd018dc 0 7126df695f8d16 00
1b 00 11 403ae2d70893c65e 405 6d02e7fdd018dc 0 71170b19135ca4 00
1b 00 11 403aa4c8f9ee3a08 405 6d02e7fdd018dc 0 71071279a7203e 00
1b 00 11 403a671a17466d5a 405 6d02e7fdd018dc 0 70f6f8cfaa7710 00
1b 00 11 4030278b795d373a 405 7b44fefe9f075c 0 6f8db48003cc19 00
1b 00 11 402b534f14b516d7 405 7fc35b97cba46c 0 6f520abd998f84 00
1b 00 11 bfe9a6a9f558e456 405 9642e82738be0c 0 6ea61bc515333d 00
1b 00 11 c031455b7a7e2208 405 b0a94e9150757c 0 6f608d212dbd41 00
1b 00 11 c032455e22742a78 405 b1867dac836d7c 0 6f869892a85ef7 00
1b 00 11 c032b45d16dc189c 405 b1b841df6ee54c 0 6f9717354846b6 00
1b 00 11 c033195eb2e66410 405 b1d61dfdfc2d2c 0 6fa619ce6b49a3 00
1b 00 11 c03375491fca4828 405 b1e80876b7584c 0 6fb3c2921e8d72 00
1b 00 11 c033c8edcfd695e8 405 b1f2c858c13efc 0 6fc030a063da87 00
1b 00 11 c034150b5bb4aa3e 405 b1f93b79fa62fc 0 6fcb804c1e2593 00
1b 00 11 c0345a4f34b749be 405 b1fd1a2783122c 0 6fd5cb5b9c02af 00
1b 00 11 c03499573013081c 405 b1fd1a2783122c 0 6fdf2943531352 00
1b 00 11 c034d2b2ee84cfe4 405 b1fd1a2783122c 0 6fe7af5b524419 00
1b 00 11 c03506e5239a11e6 405 b1fd1a2783122c 0 6fef710fe4a3ce 00
1b 00 11 c0353664bf84617e 405 b1fd1a2783122c 0 6ff6800dd3a72b 00
1b 00 11 c035619dfe1f24a4 405 b1fd1a2783122c 0 6ffcec6aadb363 00
1b 00 11 c03588f35d90ea4a 405 b1fd1a2783122c 0 70016264b65aee 00
1b 00 11 c035acbe7eba64fe 405 b1fd1a2783122c 0 70040b3de8268a 00
1b 00 11 c035cd50f1727326 405 b1fd1a2783122c 0 700676d05bc128 00
1b 00 11 c035eaf4ee609782 405 b1fd1a2783122c 0 7008aa9fdf9e78 00
1b 00 11 c03605ee001d6208 405 b1fd1a2783122c 0 700aabb1322f4e 00
1b 00 11 c0361e799d1a2bc2 405 b1fd1a2783122c 0 700c7e957166c6 00
1b 00 11 c03634cfb3aed914 405 b1fd1a2783122c 0 700e277482c566 00
1b 00 11 c0364923298cc5a4 405 b1fd1a2783122c 0 700faa168ba0b2 00
1b 00 11 c0365ba24fb94430 405 b1fd1a2783122c 0 701109ec8f3b54 00
1b 00 11 c0366c774c17f98a 405 b1fd1a2783122c 0 70124a184650f0 00
1b 00 11 c0367bc8797590c2 405 b1fd1a2783122c 0 70136d7341f408 00
1b 00 11 c03689b8beeda1ee 405 b1fd1a2783122c 0 701476956a00f8 00
1b 00 11 c0369667df72f250 405 b1fd1a2783122c 0 701567dae5f20a 00
1b 00 11 c036a1f2c22f4884 405 b1fd1a2783122c 0 701643697d8c0c 00
1b 00 11 c036ac73b45fbf96 405 b1fd1a2783122c 0 70170b357da454 00
1b 00 11 c036b602a543ac5c 405 b1fd1a2783122c 0 7017c1062c26ce 00
1b 00 11 c036beb55ca6a690 405 b1fd1a2783122c 0 70186679d58206 00
1b 00 11 c036c69fac81fcb8 405 b1fd1a2783122c 0 7018fd097cb4e0 00
1b 00 11 c036cdd39e26aa8a 405 b1fd1a2783122c 0 7019860c366564 00
1b 00 11 c036d4619b56bbba 405 b1fd1a2783122c 0 701a02ba36a624 00
1b 00 11 c036da5893abc22a 405 b1fd1a2783122c 0 701a742f985f9c 00
1b 00 11 c036dfc61e9f9888 405 b1fd1a2783122c 0 701adb6ee4b2a0 00
1b 00 11 c036e93548b6a4ca 405 b1fd1a2783122c 0 701b8ee3227582 00
1b 00 11 c036f105482447a0 405 b1fd1a2783122c 0 701c237e40261c 00
1b 00 11 c036f77d7ae48834 405 b1fd1a2783122c 0 701c9e8dc1b986 00
1b 00 11 c036fcd8fa576814 405 b1fd1a2783122c 0 701d0475cfcace 00
1b 00 11 c0370335203b931e 405 b1fd1a2783122c 0 701d7d6fc21384 00
1b 00 11 c0370951b8b7185a 405 b1fd1a2783122c 0 701df1b0d6831e 00
1b 00 11 c0370e555c174130 405 b1fd1a2783122c 0 701e5111a9d43e 00
1b 00 11 c03410daf4ab403a 405 b1fd1a2783122c 0 707a88b8e38d68 00
1b 00 11 c03410daf4ab403a 405 b1fd1a2783122c 0 707a88b8e38d68 00
1b 00 11 c03410daf4ab403a 405 b1fd1a2783122c 0 707a88b8e38d68 00
1b 00 11 c03410daf4ab403a 405 b1fd1a2783122c 0 707a88b8e38d68 00
1b 00 11 c03410daf4ab403a 405 b1fd1a2783122c 0 707a88b8e38d68 00
1b 00 11 c03410daf4ab403a 405 b1fd1a2783122c 0 707a88b8e38d68 00
1b 00 11 c03410daf4ab403a 405 b1fd1a2783122c 0 707a88b8e38d68 00
1b 00 11 c03410daf4ab403a 405 b1fd1a2783122c 0 707a88b8e38d68 00
1b 00 11 c03410daf4ab403a 405 b1fd1a2783122c 0 707a88b8e38d68 00
1b 00 11 c03410daf4ab403a 405 b1fd1a2783122c 0 707a88b8e38d68 00
1b 00 11 40f869f800000000 405 90000000000004 0 f869f800000000 00
1b 00 11 40f869f800000000 405 90000000000004 0 f869f800000000 00
1b 00 11 40f869f800000000 405 90000000000004 0 f869f800000000 00
1b 00 11 40f869f800000000 405 90000000000004 0 f869f800000000 00
1b 00 11 40f869f800000000 405 90000000000004 0 f869f800000000 00
1b 00 11 40f869f800000000 405 90000000000004 0 f869f800000000 00
1b 00 11 40f869f800000000 405 90000000000004 0 f869f800000000 00
1b 00 11 40f869f800000000 405 90000000000004 0 f869f800000000 00
1b 00 11 40f869f800000000 405 90000000000004 0 f869f800000000 00
1b 00 11 40f869f800000000 405 90000000000004 0 f869f800000000 00
1b 00 11 40f869f800000000 405 90000000000004 0 f869f800000000 00
1b 00 11 40f869f800000000 405 90000000000004 0 f869f800000000 00
1b 00 11 40f869f800000000 405 90000000000004 0 f869f800000000 00
1b 00 11 40f869f800000000 405 90000000000004 0 f869f800000000 00
1b 00 11 40f869f800000000 405 90000000000004 0 f869f800000000 00


X, Y, Z = 0.5, 100, 0.5 EXACTLY
1b 00 11 3fe0000000000000 405 90000000000003 f e0000000000000 00






CHAT:  a
CHAT:  bc
CHAT:  def
CHAT:  ghi
04 00 03 0161
05 00 03 026263
06 00 03 03646566
06 00 03 03676869


chat with many 'a's
96 01 000392016161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161


MAX
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa

MAX + 1
    size extension
80 01 00 037d6 161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161
PACKET 0 WITH SIZE -128


7f 00 037c6 1616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161
PACKET 3 WITH SIZE 127


80 01 00 037 d6 161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161
PACKET 0 WITH SIZE 128

fa 01 00 03 f6 01616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161
PACKET 3 WITH SIZE 6
'''
